import React, { useEffect, useState } from 'react'
import getDashboardAnalytics from '../../utils/Apis/dashboard/dashboard_analytics';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  PointElement,
  LineElement
} from "chart.js";
import { Line } from 'react-chartjs-2';
import moment from 'moment';
import {IaccessPagesAuthData} from '../../store/store'

ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  PointElement,
  LineElement
);


const DashboardAnalytics = ({show}: IaccessPagesAuthData) => {
  const [taskDetails, setTaskDetails] = useState([]);
  const [complianceDetails, setComplianceDetails] = useState([]);
  const [calculatorDetails, setCalculatorDetails] = useState([]);
  const [taskGraphData, setTaskGraphData] = useState([]);
  const [complianceGraphData, setComplianceGraphData] = useState([]);
  const [calculatorGraphData, setCalculatorGraphData] = useState([]);

  useEffect(() => {
    const fetchData = async () => {
      const data = await getDashboardAnalytics();
      const calculatorValues = []
      const taskValues = []
      const complianceValues = []


      data.forEach((e) => {
        switch (e.type) {
          case "Calculations":
            calculatorValues.push(e);
            break;

          case "Tasks":
            taskValues.push(e);
            break;

          case "Forms":
            complianceValues.push(e);
            break;

          default:
            break;
        }
      });


      const ExtractGraphData = (arr, type) => {
        const taskChanging = Array(13).fill(0);

        for (let i = 0; i < arr.length; i++) {
          // taskChanging.push();
          const monthNum = arr[i].month;
          const value = arr.filter((s) => s.month === monthNum)[0];

          taskChanging[monthNum] = value.total_count;

          if (type === "tasks") {
            setTaskGraphData(taskChanging);
          } else if (type === "calculations") {
            setCalculatorGraphData(taskChanging);
          } else {
            setComplianceGraphData(taskChanging);
          }
        };
      }

      setCalculatorDetails(calculatorValues);
      setComplianceDetails(complianceValues);
      setTaskDetails(taskValues);
      ExtractGraphData(taskValues, 'tasks')
      ExtractGraphData(calculatorValues, 'calculations')
      ExtractGraphData(complianceValues , 'compliance')
    }

    fetchData();
  }, [])

  const options = {
    responsive: true,
    plugins: {
      legend: {
        position: "bottom",
      },
      plotOptions: {
        bar: {
          dataLabels: {
            position: "center",
          },
          distributed: true,
        },
      },
      title: {
        display: true,
        text: 'Your Analytics',
      },
    },
    scales: {
      x: {
        grid: {
          display: false
        }
      },
      y: {
        grid: {
          display: false
        }
      }
    }
  };

  const labels = moment.months();

  const data = {
    labels,
    datasets: [
      {
        label: "Tasks",
        data: taskGraphData.slice(1),
        barThickness: 10,
        barPercentage: 1,
        maxBarThickness: 20,
        type: 'line',
        backgroundColor: "rgba(255, 99, 132, 1)",
        borderColor: "#bbb",
      },
      {
        label: "Compliance Forms",
        data: complianceGraphData.slice(1),
        barThickness: 10,
        barPercentage: 1,
        maxBarThickness: 20,
        backgroundColor: "rgba(53, 162, 235, 1)",
        borderColor: "#bbb",
        type: 'line',
      },
      {
        label: "Calculator Details",
        data: calculatorGraphData.slice(1),
        barThickness: 10,
        barPercentage: 1,
        maxBarThickness: 20,
        backgroundColor: "rgba(70, 120, 210, 50)",
        borderColor: "#bbb",
        type: 'line',
      }
    ],
  };

  if(!show)
    return null;

  return (
    <div className="col-lg-4">
      <div className='panel'>
        <div className='pHead'>
          <span className='h5'><svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"> <g clip-path="url(#clip0_352_81153)"> <path d="M5.76562 30.355H3.51562C1.96235 30.355 0.703125 29.0958 0.703125 27.5425V3.51562C0.703125 1.96235 1.96235 0.703125 3.51562 0.703125H32.4844C34.0376 0.703125 35.2969 1.96235 35.2969 3.51562V27.5425C35.2969 29.0958 34.0376 30.355 32.4844 30.355H29.6016H5.76562Z" fill="white"/> <path opacity="0.5" d="M32.4844 0.703125H3.51562C1.96235 0.703125 0.703125 1.96235 0.703125 3.51562V5.76562H35.2969V3.51562C35.2969 1.96235 34.0376 0.703125 32.4844 0.703125Z" fill="#73C3FD"/> <path opacity="0.9" d="M8.4375 27.5625H3.9375V35.2969H8.4375V27.5625Z" fill="#F6BD3D"/> <path opacity="0.9" d="M24.1875 25.7344H19.6875V35.2969H24.1875V25.7344Z" fill="#F6BD3D"/> <path opacity="0.5" d="M16.3125 19.7881H11.8125V35.2969H16.3125V19.7881Z" fill="#307FF4"/> <path opacity="0.5" d="M32.0625 18.7383H27.5625V35.2969H32.0625V18.7383Z" fill="#73C3FD"/> <path opacity="0.5" d="M13.667 13.918C14.6766 13.918 15.4951 13.0995 15.4951 12.0898C15.4951 11.0802 14.6766 10.2617 13.667 10.2617C12.6573 10.2617 11.8389 11.0802 11.8389 12.0898C11.8389 13.0995 12.6573 13.918 13.667 13.918Z" fill="#307FF4"/> <path opacity="0.9" d="M21.8721 22.2891C22.8817 22.2891 23.7002 21.4706 23.7002 20.4609C23.7002 19.4513 22.8817 18.6328 21.8721 18.6328C20.8624 18.6328 20.0439 19.4513 20.0439 20.4609C20.0439 21.4706 20.8624 22.2891 21.8721 22.2891Z" fill="#F6BD3D"/> <path opacity="0.5" d="M29.8125 13.918C30.8221 13.918 31.6406 13.0995 31.6406 12.0898C31.6406 11.0802 30.8221 10.2617 29.8125 10.2617C28.8029 10.2617 27.9844 11.0802 27.9844 12.0898C27.9844 13.0995 28.8029 13.918 29.8125 13.918Z" fill="#73C3FD"/> <path opacity="0.9" d="M6.14062 21.6162C7.15027 21.6162 7.96875 20.7977 7.96875 19.7881C7.96875 18.7784 7.15027 17.96 6.14062 17.96C5.13098 17.96 4.3125 18.7784 4.3125 19.7881C4.3125 20.7977 5.13098 21.6162 6.14062 21.6162Z" fill="#F6BD3D"/> <path d="M33.5449 30.9728C34.8986 30.9728 36 29.8714 36 28.5176V3.51562C36 1.57711 34.4229 0 32.4844 0H3.51562C1.57711 0 0 1.57711 0 3.51562V28.5176C0 29.8714 1.10137 30.9728 2.4551 30.9728H3.23438V34.5938H0.703125C0.314789 34.5938 0 34.9086 0 35.2969C0 35.6851 0.314789 36 0.703125 36H35.2969C35.6852 36 36 35.6851 36 35.2969C36 34.9086 35.6852 34.5938 35.2969 34.5938H32.7656V30.9728H33.5449ZM3.51562 1.40625H32.4844C33.6475 1.40625 34.5938 2.35252 34.5938 3.51562V5.0625H1.47684C1.45301 5.0625 1.42945 5.06377 1.40625 5.06609V3.51562C1.40625 2.35252 2.35252 1.40625 3.51562 1.40625ZM4.64062 34.5938V28.2656H7.73438V34.5938H4.64062ZM12.5156 34.5938V20.4913H15.6094V34.5938H12.5156ZM20.3906 34.5938V26.4375H23.4844V34.5938H20.3906ZM28.2656 34.5938V27.0176C28.2656 26.6293 27.9508 26.3145 27.5625 26.3145C27.1742 26.3145 26.8594 26.6293 26.8594 27.0176V34.5938H24.8906V25.7344C24.8906 25.3461 24.5758 25.0312 24.1875 25.0312H19.6875C19.2992 25.0312 18.9844 25.3461 18.9844 25.7344V34.5938H17.0156V19.7882C17.0156 19.3999 16.7008 19.0851 16.3125 19.0851H11.8125C11.4242 19.0851 11.1094 19.3999 11.1094 19.7882V34.5938H9.14062V27.5625C9.14062 27.1742 8.82584 26.8594 8.4375 26.8594H3.9375C3.54916 26.8594 3.23438 27.1742 3.23438 27.5625V29.5665H2.4551C1.87671 29.5665 1.40625 29.096 1.40625 28.5176V6.46516C1.42945 6.46748 1.45301 6.46875 1.47684 6.46875H34.5938V28.5176C34.5938 29.096 34.1232 29.5665 33.5449 29.5665H32.7656V18.7383C32.7656 18.35 32.4508 18.0352 32.0625 18.0352H27.5625C27.1742 18.0352 26.8594 18.35 26.8594 18.7383V22.289C26.8594 22.6773 27.1742 22.9921 27.5625 22.9921C27.9508 22.9921 28.2656 22.6773 28.2656 22.289V19.4414H31.3594V34.5938H28.2656Z" fill="#171D34"/> <path d="M15.6143 3.9375H31.5003C31.8886 3.9375 32.2034 3.62264 32.2034 3.23438C32.2034 2.84611 31.8886 2.53125 31.5003 2.53125H15.6143C15.2259 2.53125 14.9111 2.84611 14.9111 3.23438C14.9111 3.62264 15.2259 3.9375 15.6143 3.9375Z" fill="#171D34"/> <path d="M7.3125 3.9375C7.49742 3.9375 7.67883 3.86227 7.80961 3.73141C7.94039 3.6007 8.01562 3.4193 8.01562 3.23438C8.01562 3.04945 7.94039 2.86805 7.80961 2.73727C7.67883 2.60648 7.49742 2.53125 7.3125 2.53125C7.12758 2.53125 6.94617 2.60641 6.81539 2.73727C6.68461 2.86805 6.60938 3.04945 6.60938 3.23438C6.60938 3.4193 6.68461 3.6007 6.81539 3.73141C6.94617 3.86227 7.12758 3.9375 7.3125 3.9375Z" fill="#171D34"/> <path d="M4.5 3.9375C4.68492 3.9375 4.86633 3.86227 4.99711 3.73141C5.12789 3.6007 5.20312 3.4193 5.20312 3.23438C5.20312 3.04945 5.12789 2.86805 4.99711 2.73727C4.86633 2.60648 4.68492 2.53125 4.5 2.53125C4.31508 2.53125 4.13367 2.60641 4.00289 2.73727C3.87211 2.86805 3.79688 3.04945 3.79688 3.23438C3.79688 3.4193 3.87211 3.6007 4.00289 3.73141C4.13367 3.86227 4.31508 3.9375 4.5 3.9375Z" fill="#171D34"/> <path d="M10.125 3.9375C10.3099 3.9375 10.4913 3.86227 10.6221 3.73141C10.7529 3.6007 10.8281 3.4193 10.8281 3.23438C10.8281 3.04945 10.7529 2.86805 10.6221 2.73727C10.4913 2.60648 10.3106 2.53125 10.125 2.53125C9.94008 2.53125 9.75867 2.60641 9.62789 2.73727C9.49711 2.86805 9.42188 3.04945 9.42188 3.23438C9.42188 3.4193 9.49711 3.6007 9.62789 3.73141C9.75867 3.86227 9.94008 3.9375 10.125 3.9375Z" fill="#171D34"/> <path d="M27.5625 24.0918C27.3776 24.0918 27.1962 24.1664 27.0654 24.2978C26.9346 24.4286 26.8594 24.61 26.8594 24.7949C26.8594 24.9798 26.9346 25.1612 27.0654 25.292C27.1962 25.4227 27.3776 25.498 27.5625 25.498C27.7474 25.498 27.9288 25.4228 28.0596 25.292C28.1904 25.1612 28.2656 24.9798 28.2656 24.7949C28.2656 24.6093 28.1904 24.4286 28.0596 24.2978C27.9288 24.1663 27.7474 24.0918 27.5625 24.0918Z" fill="#171D34"/> <path d="M29.8123 14.6211C31.2081 14.6211 32.3436 13.4856 32.3436 12.0898C32.3436 10.6941 31.2081 9.55859 29.8123 9.55859C28.4165 9.55859 27.2811 10.6941 27.2811 12.0898C27.2811 12.6443 27.4607 13.1573 27.7642 13.5747L23.0937 18.2452C22.7312 18.0446 22.3148 17.93 21.872 17.93C21.473 17.93 21.0954 18.0232 20.7594 18.1883L15.8826 13.3115C16.0832 12.9491 16.1978 12.5327 16.1978 12.0898C16.1978 10.6941 15.0623 9.55859 13.6665 9.55859C12.2708 9.55859 11.1353 10.6941 11.1353 12.0898C11.1353 12.5777 11.2744 13.0334 11.5144 13.4203L7.36223 17.5724C6.99977 17.3718 6.58338 17.2572 6.14062 17.2572C4.74485 17.2572 3.60938 18.3927 3.60938 19.7884C3.60938 21.1842 4.74485 22.3197 6.14062 22.3197C7.5364 22.3197 8.67188 21.1842 8.67188 19.7884C8.67188 19.3456 8.55727 18.9292 8.35666 18.5667L12.5584 14.365C12.8933 14.5288 13.2693 14.621 13.6665 14.621C14.1093 14.621 14.5257 14.5064 14.8881 14.3058L19.7172 19.1348C19.4788 19.5208 19.3407 19.975 19.3407 20.4611C19.3407 21.8569 20.4762 22.9924 21.872 22.9924C23.2678 22.9924 24.4032 21.8569 24.4032 20.4611C24.4032 20.0183 24.2886 19.6019 24.088 19.2394L28.8837 14.4438C29.1715 14.5578 29.4846 14.6211 29.8123 14.6211ZM29.8123 10.9648C30.4326 10.9648 30.9373 11.4695 30.9373 12.0898C30.9373 12.7101 30.4326 13.2148 29.8123 13.2148C29.192 13.2148 28.6873 12.7101 28.6873 12.0898C28.6873 11.4695 29.192 10.9648 29.8123 10.9648ZM6.1407 20.9136C5.5204 20.9136 5.0157 20.4089 5.0157 19.7886C5.0157 19.1683 5.5204 18.6636 6.1407 18.6636C6.76099 18.6636 7.2657 19.1683 7.2657 19.7886C7.2657 20.4089 6.76099 20.9136 6.1407 20.9136ZM13.6666 13.2148C13.0463 13.2148 12.5416 12.7101 12.5416 12.0898C12.5416 11.4695 13.0463 10.9648 13.6666 10.9648C14.2869 10.9648 14.7916 11.4695 14.7916 12.0898C14.7916 12.7101 14.2869 13.2148 13.6666 13.2148ZM21.8721 21.5863C21.2518 21.5863 20.7471 21.0815 20.7471 20.4613C20.7471 19.841 21.2518 19.3363 21.8721 19.3363C22.4924 19.3363 22.9971 19.841 22.9971 20.4613C22.9971 21.0815 22.4924 21.5863 21.8721 21.5863Z" fill="#171D34"/> <path d="M9.93262 10.2666C10.1175 10.2666 10.2982 10.1914 10.4297 10.0606C10.5605 9.9298 10.6357 9.7484 10.6357 9.56348C10.6357 9.37856 10.5605 9.19715 10.4297 9.06644C10.2982 8.93566 10.1175 8.86035 9.93262 8.86035C9.74699 8.86035 9.56559 8.93559 9.4348 9.06644C9.30402 9.19715 9.22949 9.37856 9.22949 9.56348C9.22949 9.7484 9.30402 9.9298 9.4348 10.0606C9.56629 10.1914 9.74699 10.2666 9.93262 10.2666Z" fill="#171D34"/> <path d="M3.9375 10.2676H7.3125C7.70084 10.2676 8.01562 9.95272 8.01562 9.56445C8.01562 9.17619 7.70084 8.86133 7.3125 8.86133H3.9375C3.54916 8.86133 3.23438 9.17619 3.23438 9.56445C3.23438 9.95272 3.54916 10.2676 3.9375 10.2676Z" fill="#171D34"/> <path d="M7.3125 13.6426C7.70084 13.6426 8.01562 13.3277 8.01562 12.9395C8.01562 12.5512 7.70084 12.2363 7.3125 12.2363H3.9375C3.54916 12.2363 3.23438 12.5512 3.23438 12.9395C3.23438 13.3277 3.54916 13.6426 3.9375 13.6426H7.3125Z" fill="#171D34"/> </g> <defs> <clipPath id="clip0_352_81153"> <rect width="36" height="36" fill="white"/> </clipPath> </defs> </svg> Analytics</span>
        </div>
        <div className='pBody pb-0'>
          <Line data={data} options={options} />
        </div>
        <span className='moreBtn'><svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M2.5625 1.625C2.5625 1.81042 2.50752 1.99168 2.4045 2.14585C2.30149 2.30002 2.15507 2.42018 1.98377 2.49114C1.81246 2.56209 1.62396 2.58066 1.4421 2.54449C1.26025 2.50831 1.0932 2.41902 0.962088 2.28791C0.830976 2.1568 0.741688 1.98975 0.705514 1.8079C0.669341 1.62604 0.687906 1.43754 0.758863 1.26623C0.829821 1.09493 0.949982 0.948511 1.10415 0.845498C1.25832 0.742484 1.43958 0.6875 1.625 0.6875C1.87364 0.6875 2.1121 0.786272 2.28791 0.962088C2.46373 1.1379 2.5625 1.37636 2.5625 1.625ZM8 0.6875C7.81458 0.6875 7.63332 0.742484 7.47915 0.845498C7.32498 0.948511 7.20482 1.09493 7.13386 1.26623C7.06291 1.43754 7.04434 1.62604 7.08051 1.8079C7.11669 1.98975 7.20598 2.1568 7.33709 2.28791C7.4682 2.41902 7.63525 2.50831 7.8171 2.54449C7.99896 2.58066 8.18746 2.56209 8.35877 2.49114C8.53007 2.42018 8.67649 2.30002 8.7795 2.14585C8.88252 1.99168 8.9375 1.81042 8.9375 1.625C8.9375 1.37636 8.83873 1.1379 8.66291 0.962088C8.4871 0.786272 8.24864 0.6875 8 0.6875ZM14.375 2.5625C14.5604 2.5625 14.7417 2.50752 14.8958 2.4045C15.05 2.30149 15.1702 2.15507 15.2411 1.98377C15.3121 1.81246 15.3307 1.62396 15.2945 1.4421C15.2583 1.26025 15.169 1.0932 15.0379 0.962088C14.9068 0.830976 14.7398 0.741688 14.5579 0.705514C14.376 0.66934 14.1875 0.687906 14.0162 0.758864C13.8449 0.829821 13.6985 0.949982 13.5955 1.10415C13.4925 1.25832 13.4375 1.43958 13.4375 1.625C13.4375 1.87364 13.5363 2.1121 13.7121 2.28791C13.8879 2.46373 14.1264 2.5625 14.375 2.5625ZM1.625 7.4375C1.43958 7.4375 1.25832 7.49248 1.10415 7.5955C0.949982 7.69851 0.829821 7.84493 0.758863 8.01624C0.687906 8.18754 0.669341 8.37604 0.705514 8.5579C0.741688 8.73975 0.830976 8.9068 0.962088 9.03791C1.0932 9.16903 1.26025 9.25831 1.4421 9.29449C1.62396 9.33066 1.81246 9.3121 1.98377 9.24114C2.15507 9.17018 2.30149 9.05002 2.4045 8.89585C2.50752 8.74168 2.5625 8.56042 2.5625 8.375C2.5625 8.12636 2.46373 7.8879 2.28791 7.71209C2.1121 7.53627 1.87364 7.4375 1.625 7.4375ZM8 7.4375C7.81458 7.4375 7.63332 7.49248 7.47915 7.5955C7.32498 7.69851 7.20482 7.84493 7.13386 8.01624C7.06291 8.18754 7.04434 8.37604 7.08051 8.5579C7.11669 8.73975 7.20598 8.9068 7.33709 9.03791C7.4682 9.16903 7.63525 9.25831 7.8171 9.29449C7.99896 9.33066 8.18746 9.3121 8.35877 9.24114C8.53007 9.17018 8.67649 9.05002 8.7795 8.89585C8.88252 8.74168 8.9375 8.56042 8.9375 8.375C8.9375 8.12636 8.83873 7.8879 8.66291 7.71209C8.4871 7.53627 8.24864 7.4375 8 7.4375ZM14.375 7.4375C14.1896 7.4375 14.0083 7.49248 13.8542 7.5955C13.7 7.69851 13.5798 7.84493 13.5089 8.01624C13.4379 8.18754 13.4193 8.37604 13.4555 8.5579C13.4917 8.73975 13.581 8.9068 13.7121 9.03791C13.8432 9.16903 14.0102 9.25831 14.1921 9.29449C14.374 9.33066 14.5625 9.3121 14.7338 9.24114C14.9051 9.17018 15.0515 9.05002 15.1545 8.89585C15.2575 8.74168 15.3125 8.56042 15.3125 8.375C15.3125 8.12636 15.2137 7.8879 15.0379 7.71209C14.8621 7.53627 14.6236 7.4375 14.375 7.4375Z" fill="#171D34"/> </svg></span>
      </div>
    </div>
  )
}

export default DashboardAnalytics